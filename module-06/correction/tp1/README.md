# Correction TP 1

1. Avec l'attribut `ports`;
2. Yaml;
3. Avec la commande `docker compose ps`;
4. Vrai;
5. Vrai;
6. Faux, `build : .` informe Docker de construire l’image en utilisant le répertoire courant (`.`) où (doit) se trouve(r) le `Dockerfile`
7. Vrai. Sous l'attribut yaml `environment`. Les variables d'environnement définis dans compose override ceux précédemment définis (ils ont la précédence);
8. Les fichiers `.env` sont de simples fichiers texte permettant de définir les variables d'environnement à mettre à disposition des conteneurs lorsqu'ils sont lancés avec `docker compose up`. Les variables sont définies sous la forme de simples clefs/valeurs, `FOO=BAR`. Ils permettent de centraliser la gestion des variables d'environnement, de clarifier le fichier compose et de gérer les différentes environnements. Ils doivent être placés à côté (même repertoire) que les fichiers `compose`;
9. [L'*interpolation*](https://docs.docker.com/compose/environment-variables/env-file/#interpolation) est un mécanisme qui permet de substituer au moment de l'execution des références vers des variables d'environnement par leurs valeurs. La syntaxe, dans le `compose`. est du type `$VARIABLE` ou `${VARIABLE}`. À l'exécution, cette chaîne de caractères sera remplacée par la valeur de la clef `VARIABLE` définie dans un fichier d'environnement;
10. Oui, car au delà des variables d'environnement (on crée généralement un fichier d’environnement par... environnement), il y a notamment des services ou des volumes que l'on peut utiliser en environnement de développement et non en environnement de production. Généralement, on définit plusieurs fichiers compose, un pour chaque environnement. [Lire la documentation et les conseils sur le sujet.](https://docs.docker.com/compose/multiple-compose-files/)
11. D'après [la doc](https://docs.docker.com/compose/multiple-compose-files/), lorsque l'on travaille avec plusieurs fichiers compose on peut utiliser plusieurs mécanismes : le [merge](https://docs.docker.com/compose/multiple-compose-files/merge/) de plusieurs fichiers, [l'extension](https://docs.docker.com/compose/multiple-compose-files/extends/) et [l'inclusion](https://docs.docker.com/compose/multiple-compose-files/include/).
12. [Les profils](https://docs.docker.com/compose/profiles/) dans Docker Compose permettent d'inclure ou d'exclure certains services lors du démarrage en fonction du contexte d'exécution. Ils permettent de définir des groupes de services activables via la variable d'environnement COMPOSE_PROFILES ou l'option --profile de docker compose up.
13. Les secrets dans les fichiers compose permettent de gérer de manière sécurisée des informations sensibles, comme des mots de passe ou des clés d'API. Les variables d'environnement sont généralement accessibles à tous les processus, et il est difficile de définir leurs règles d'accès. Elles peuvent aussi être imprimées dans les logs. L'utilisation de secrets diminue le risque en scopant l'accès aux secrets et en les injectant à la création de conteneurs de manière sécurisée.
14. Il **faut reconstruire** l'image à chaque fois que l'on modifie les sources ! **On ne peut pas modifier une image**. Donc, à chaque modification, il faut relancer `docker build`. Même avec l'utilisation du cache, cette situation n'est pas tenable. Plusieurs solutions : 
    1.  Utiliser un *volume*/*bind-mount* pour stocker les sources et avoir un *rafraîchissement* du contenu de l'image (sources) immédiat;
    2.  Dorénavant, Docker Compose propose [un mécanisme de watch](https://docs.docker.com/compose/file-watch/) des sources intégré via Compose Watch. 
**Compose Watch** est plus performant, plus intéressant en termes de contrôle et permet d'éviter d'avoir à définir un volume supplémentaire. C'est la solution à privilégier aujourd'hui.